# Internationalization (i18n) Guide

This project uses a lightweight translation system embedded in `app_new.js` via a `translations` object. Alpine.js powers dynamic binding with the helper `t(key)` and `showToastKey(key, replacements)`.

## 1. Translation Data Structure
Top-level `translations` object contains one property per locale code (`en`, `zh`, `ja`, ...). Each locale maps string keys to translated text.

```
translations: {
  en: { tab_dashboard: 'Dashboard', ... },
  zh: { tab_dashboard: '儀表板', ... },
  ja: { tab_dashboard: 'ダッシュボード', ... }
}
```

## 2. Using Translations in Templates
HTML bindings use Alpine: `x-text="t('key')"`. Provide an English fallback inside the tag only for readability during development; it will be replaced at runtime.

Example:
```
<h2 x-text="t('pcap_manual_title')">Manual Packet Capture</h2>
```

## 3. Toasts and Placeholders
To show a toast from a key: `showToastKey('toast_hosts_found', { count: 5 })`.

Placeholder syntax: `{name}` inside the translation value. The helper replaces all matching occurrences.

Example key:
```
toast_hosts_found: 'Found {count} hosts'
```

## 4. Adding a New Language
1. Pick a BCP-47 short code (e.g. `fr`, `de`, `es`).
2. Add a new object under `translations` mirroring existing keys.
3. Translate every value. Missing keys will fallback to English.
4. (Optional) Update any language selector UI to include the new code.

## 5. Adding New Keys
1. Add the key/value to ALL existing locales; keep English as the reference.
2. If not immediately translated for other locales, copy the English string temporarily so users see something useful.
3. Use consistent naming: group with prefixes (`pcap_`, `toast_`, `assistant_`, `metric_`).

## 6. Fallback Behavior
`t(key)` attempts: current locale -> English -> original key name. This prevents runtime crashes if a key is missing and surfaces the key for quick debugging.

## 7. Confirm Dialogs and Static Prompts
All user-facing text should live in `translations`. For a confirm:
```
if (confirm(t('confirm_clear_chat'))) { ... }
```
Avoid embedding raw language-specific strings in JS logic.

## 8. Quality Checklist When Editing i18n
- [ ] No stray keys outside `translations` object.
- [ ] All locales contain the new key (temporarily duplicated if not translated yet).
- [ ] No hard-coded user-facing text remains in methods (search for non-key Chinese/Japanese phrases if adding languages).
- [ ] Placeholder braces `{}` match replacement names exactly.
- [ ] Commas and braces validate (run linter / get_errors tool).

## 9. Common Prefixes Reference
- `tab_` : Navigation tabs
- `pcap_` : Packet capture tutorial and analysis
- `toast_` : Toast notifications
- `assistant_` : Voice assistant UI labels
- `metric_` : PCAP metrics
- `broadcast_` / `intercom_` : Intercom system

## 10. Testing a Language Switch
1. Change `language` via UI or set in console: `Alpine.$data(document.body).setLanguage('ja')`.
2. Verify sections: Navigation, Intercom, Voice Assistant, Packet Capture tutorial, toasts.
3. Trigger network scan and PCAP upload to ensure toast placeholders render.

## 11. Adding Placeholder Examples
```
toast_analysis_start: 'Analyzing PCAP...'
toast_hosts_found: 'Found {count} hosts'
error_generic: 'Error: {msg}'
```
Usage:
```
showToastKey('error_generic', { msg: 'Timeout' })
```

## 12. Future Enhancements
- Externalize translations to JSON files for dynamic loading.
- Add language autodetect (browser `navigator.language`).
- Provide runtime missing-key reporting overlay for translators.

## 13. Troubleshooting
| Symptom | Cause | Fix |
|---------|-------|-----|
| "',' expected" near translations | Missing comma between keys | Check last added key, ensure comma except for last value |
| Undefined toast shows key name | Missing key in active locale | Add key to locale or rely on fallback English |
| Mixed languages after switch | Hard-coded text in HTML/JS | Replace with `x-text="t('key')"` or `t('key')` in JS |

## 14. Contributing Translations
Submit a patch adding the new locale object. Keep ordering consistent with existing locales to simplify diff reviews.

---
Maintained: i18n system version 1.0. For questions or improvements, add issues referencing the key prefix groups above.
